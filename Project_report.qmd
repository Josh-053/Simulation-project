---
title: "PopPK-Based Dosing Optimization for Triazoconazole"
author: "Joshua Ijidakinro, Ali Kazim"
affiliation: "Faculty of Pharmaceutical Sciences, KU Leuven"
format:
  pdf:
    papersize: A4
number-sections: true
date: today
bibliography: bibliography.bib
csl: elsevier-vancouver.csl
execute:
  echo: true
  warning: false
  message: false
output: bookdown::pdf_document2
---

## Introduction

Brontogen fibropathy (BF) is an inherited disorder that leads to changes in lung tissue and airflow over time. Patients with BF develop infection from *Spirgilus viridicaulis*, a fungal species that grows in warm and humid regions. This fungus can be treated using the antimycotic drug triazoconazole. This drug is administered to children with BF for off-label use, as it is originally indicated for patients with bronchiectasis.

## Objectives

The purpose of the simulation was to evaluate whether the administered dose of 150 mg once a day evoked sufficient exposure with area under the curve from time zero to 24 hours (AUC~0-24~) of 28 mg·h/L for children with BF. The goal was also to suggest an optimal dosing regimen based on the simulation results.

## Methods
```{r}
#| include: false
# given in supplementary data: median and range of BW (kg)
BWmin = 24
BWmedian = 38
BWmax = 75

# dose normalized by body weight
dose1 = 150 / BWmedian
dose2 = dose1 / 17.61 * 28 # dose proportionality, determined for BWmedian
```

A study of 48 pediatric patients was simulated over 100 replicates, resulting in a total of 4800 simulated patients. The patients had a body weight ranging between **`r BWmin` and `r BWmax` kg**, with a median of **`r BWmedian` kg**. The simulation was performed via `mrgsolve` package in `R`, using the population pharmacokinetic (popPK) model shown in the next page. It is a one-compartment model with oral absorption and linear elimination. The pharmacokinetic parameters absorption rate constant (`ka`), clearance (`CL`) and volume of distribution (`V`) are correlated with the body weight (`BW`) using power function.

A dosing event was created for the administered regimen of 150 mg q24h. This dose was corrected for median body weight, resulting in a regimen of **3.85 mg/kg q24h**. This regimen was used to simulate the individual predicted plasma concentration-time profile (IPRED) and the cumulative area under the curve (cAUC). AUC~0-24~ was calculated using the continuous AUC integration method of adding cAUC from 0 to 24 hours. Five empirical dosing regimens were simulated in the same manner as the administered regimen, these were as follows: **3.85 mg/kg q8h, 3.85 mg/kg q12h, 6.32 mg/kg q24h, 8.00 mg/kg q24h and 9.50 mg/kg q24h**. Higher doses were selected based on the assumption of dose proportionality @schmith. The probability of target attainment (PTA, %) was calculated for all regimens across the body weight range, with the target AUC~0-24~ set at **28 mg·h/L**. The target PTA was set at 95%. 

```{r packages}
#| include: false

if (!require("pacman")) {
  install.packages("pacman")
  library(pacman)}

pacman::p_load(mrgsolve, ggplot2, kableExtra, tidyverse, bookdown)
```

```{cpp}
#| eval: false
// Simulation Code

$PARAM
TVCL   = 7.95,  // L/h
TVV    = 190,   // L 
TVka   = 0.17,  // 1/h

$CMT   DEPOT CENT cAUC // 1-compartmental model with absorption
$INPUT BW = 38 // kg, covariate which has effect on PK parameters

$MAIN
double BWEffCL = 0.75    ; // BW effect on CL
double BWEffV  = 1       ; // BW effect on V
double BWEffka = -(0.25) ; // BW effect on ka

double CL  = TVCL * pow((BW/70),BWEffCL) * exp(ETA(1)) ;
double V   = TVV  * pow((BW/70),BWEffV)                ;
double ka  = TVka * pow((BW/70),BWEffka)               ;

double k10 = CL/V ; 

$OMEGA 0.1415863641 // CV_CL = 39%

$SIGMA 0.0974896213 // EPS(1)
       0.0324       // EPS(2)

$ODE   dxdt_DEPOT = -(ka) * DEPOT                 ;
       dxdt_CENT  =  (ka) * DEPOT  - (k10) * CENT ;
       dxdt_cAUC  =                  CENT/V       ;

$TABLE 
double IPRED      = CENT/V                       ; 
double DV         = IPRED * (1+EPS(1)) + EPS(2)  ;
double BWsim      = BW                           ;

$CAPTURE IPRED DV
```

## Results

```{r}
#| include: false
mod <- mread("project")

set.seed(123)      # reproducibility
N      <- 100L     # number of replicates
N_id   <- 48L      # number of patients per replicate
delta  <- 0.1      # hours (h)
tot_id <- N * N_id
```

```{r}
#| include: false
run_regimen <- function(dose, body_weight, interval, addl_dose, label) {
  out <- mrgsim(mod %>% init(cAUC = 0) %>% param(BW = body_weight),
                e      = ev(amt = dose * body_weight, time = 0,
                            ii = interval, addl = addl_dose),
                nid    = tot_id,
                tgrid  = tgrid(start = 0, end = 24, delta = delta),
                output = "df")
  
  rows24  <- out$time == 24
  auc_vec <- out$cAUC[rows24]

  list(sim = transform(out, regimen = label),
       auc = data.frame(regimen = label, AUC_0_24 = auc_vec))
}
```

```{r}
#| include: false
res1 <- run_regimen(dose1, BWmedian, 24, 0, "3.95 mg/kg q24h")
res2 <- run_regimen(dose1, BWmedian, 12, 1, "3.95 mg/kg q12h")
res3 <- run_regimen(dose1, BWmedian,  8, 2, "3.95 mg/kg q8h")
res4 <- run_regimen(dose2, BWmedian, 24, 0, "6.32 mg/kg q24h")
res5 <- run_regimen(8,     BWmedian, 24, 0, "8.00 mg/kg q24h")
res6 <- run_regimen(9.50,  BWmedian, 24, 0, "9.50 mg/kg q24h")

auc_all <- bind_rows(res1$auc, res2$auc, res3$auc,
                     res4$auc, res5$auc, res6$auc)
```

The table below (@tbl-AUC1) demonstrates the tested dosing regimens for a pediatric patient with median body weight of **38 kg**, along with their summary statistics for AUC~0-24~. The probability of target attainment (PTA, %) has also been included in the table, with a target AUC~0-24~ of **28 mg·h/L**. The dosing regimen of interest (150 mg q24h, corresponding to **3.95 mg/kg q24h**) elicits an AUC~0-24~ of `r signif(median(auc_all$AUC_0_24[auc_all$regimen=="3.95 mg/kg q24h"], digits = 4))` mg·h/L, which corresponds to a PTA of zero percent. Only regimen **9.50 mg/kg q24h** has a PTA of at least 95%.

```{r}
#| echo: false
#| label: tbl-AUC1
#| tbl-cap: "AUC (0–24 h, in mg·h/L) Summary by Regimen for Median BW of 38 kg."
auc_summary <- auc_all %>%
  group_by(regimen) %>%
  summarize(median_AUC_0_24 = median(AUC_0_24),
            mean_AUC_0_24   = mean(AUC_0_24),
            sd_AUC_0_24     = sd(AUC_0_24),
            PTA             = mean(AUC_0_24 >= 28) * 100,
            .groups = "drop")

auc_summary %>%
  kable(
    format   = "latex", # PDF/LaTeX output
    booktabs = TRUE,    # nicer horizontal rules
    digits   = 4,       # numeric rounding
    col.names = c("Regimen", "Median", "Mean", "SD", "PTA (%)"),
    align    = c("l", "r", "r", "r", "r"),
    longtable = TRUE
  )
```

Given that the body weight in this study was added as a covariate for PK parameters (see previous page), it was important to assess the dosing regimen across studied body weight range. @tbl-AUC2 shows summary statistics of AUC~0-24h~ of dosing regimen **9.50 mg/kg q24h** for the minimum, median and maximum body weight.

```{r}
#| echo: false
#| label: tbl-AUC2
#| tbl-cap: "AUC (0–24 h, in mg·h/L) Summary by BW for 9.50 mg/kg q24h."
res6 <- res6 %>%
  map(~ .x %>% mutate(regimen = recode(regimen, "9.50 mg/kg q24h" = "38 (median)")))
res7 <- run_regimen(9.50, BWmin, 24, 0, "24 (min)")
res8 <- run_regimen(9.50, BWmax, 24, 0, "75 (max)")

sim_BW <- bind_rows(res6$sim, res7$sim, res8$sim)
auc_BW <- bind_rows(res6$auc, res7$auc, res8$auc)

auc_BW <- auc_BW %>% 
  mutate(dose_BW = case_when(
    regimen == "38 (median)" ~ 38,
    regimen == "24 (min)" ~ 24,
    regimen == "75 (max)" ~ 75))

auc_BW$dose_BW = auc_BW$dose_BW * 9.50

auc_summary <- auc_BW %>%
  group_by(regimen) %>%
  summarize(actual_dose = unique(dose_BW),
            median_AUC_0_24 = median(AUC_0_24),
            mean_AUC_0_24   = mean(AUC_0_24),
            sd_AUC_0_24     = sd(AUC_0_24),
            PTA             = mean(AUC_0_24 >= 28) * 100,
            .groups = "drop")

auc_summary %>%
  kable(
    format   = "latex", # PDF/LaTeX output
    booktabs = TRUE,    # nicer horizontal rules
    digits   = 4,       # numeric rounding
    col.names = c("Body Weight (kg)", "Dose (mg)", "Median", "Mean", "SD", "PTA (%)"),
    align    = c("l", "r", "r", "r", "r", "r"),
    longtable = TRUE
  )
```

{{< pagebreak >}} 

Below is @fig-regimens that shows the IPRED plotted against time for regimen of 9.50 mg/kg for minimum, median and maximum body weights. The figure shows that patients with higher body weight clear the drug faster, as seen from the decreasing slope.

![Comparison of concentration-time profiles for tested dosing regimens, using the median (line), 5th and 95th percentile (shaded ribbon) of IPRED](C_p_plots_regimens.png){#fig-regimens}

```{r}
#| include: false
ipred_summary <- sim_BW %>%
  group_by(regimen, time) %>%
  summarize(IPRED_median = median(IPRED),
            IPRED_lo     = quantile(IPRED, 0.05),
            IPRED_hi     = quantile(IPRED, 0.95),
            .groups = "drop")

ggplot(ipred_summary,
       aes(x = time,
           color = regimen)) +
  geom_ribbon(aes(ymin = IPRED_lo,
                  ymax = IPRED_hi,
                  fill = regimen),
              alpha = 0.15,
              color = NA)+
  geom_line(aes(y = IPRED_median),
            linewidth = 1) +
  scale_color_manual(values = c("red", "forestgreen", "blue")) +
  scale_fill_manual(values =  c("red", "forestgreen", "blue")) +
  guides(fill="none") +
  labs(x = "Time (h)",
    y = "IPRED (mg/L)",
    color = "Body Weight (kg)") +
  theme_minimal() + 
  theme(legend.position = "bottom")

ggsave("C_p_plots_regimens.png", width = 4.5, height = 3.7, dpi = 300, units = "in")
```

## Discussion

In this study, a popPK model was used for the simulation of regimens for dose optimizations of triazoconazole in children with Brontogen fibropathy (BF). As seen in @tbl-AUC1, the PTA was zero percent for dosing regimen of **150 mg q24h**. This means that none of the virtual patients evoked sufficient exposure. Increasing the dose led to an increase in exposure, while the same effect was achieved from reducing the inter-dose interval. However, administering the dose more frequently might lead to reduced patient compliance. Therefore, regimens **9.50 mg/kg q24h** was regarded as suitable dosing regimens.

There were limitations in the study: due to limited data on response and toxicity profile, the safety of the dosing regimens of triazoconazole could not be assessed. Furthermore, no exposure-response relationship could be established. Once sufficient response and toxicity data are available, the safety of the proposed dosing regimens will be evaluated, and exposure-response analysis will be carried out.

## Conclusion

The study suggests that the dosing regimen of **150 mg q24h** proposed by Dr. Tagore, elicits an insufficient exposure. Dosing regimen of **9.50 mg/kg q24h** is proposed and expected to achieve the target exposure and elicit optimal response against *S. viridicaulis* in children with Brontogen fibropathy.

## Acknowledgement {.unnumbered}

We would like to thank Dr. Sarojini Tagore, Pediatrician at Gavabhata Hospital and Research Centre, Amumbi, South Asia, for initiating this collaboration and sharing valuable clinical insights on Brontogen fibropathy and triazoconazole therapy. Our appreciation also goes to Dr. Lydia Majorana from Sicilia for her expert guidance on BF management and to Dr. Ramesh Thapali of Metrum Research Group for his contribution to the development of the PopPK model.

We would like to express our gratitude to Emmanuel Niyigena and his creative mind for coming up with this research.

## References {.unnumbered}

::: {#refs}
:::

{{< pagebreak >}}

## Appendix: R Scripts {.unnumbered}

```{r}
#| eval: false

if (!require("pacman")) {install.packages("pacman")
  library(pacman)}

pacman::p_load(mrgsolve, ggplot2, kableExtra, tidyverse, bookdown)
```

```{r}
#| eval: false
mod <- mread("project")

set.seed(123)      # reproducibility
N      <- 100L     # number of replicates
N_id   <- 48L      # number of patients per replicate
delta  <- 0.1      # hours (h)
tot_id <- N * N_id
```

```{r}
#| eval: false
BWmin = 24    # BW (kg) median and range given in supplementary data
BWmedian = 38
BWmax = 75

dose1 = 150 / BWmedian     # administered dose normalized by body weight
dose2 = dose1 / 17.61 * 28 # dose proportionality, determined for BWmedian

run_regimen <- function(dose, body_weight, interval, addl_dose, label) {
  out <- mrgsim(mod %>% init(cAUC = 0) %>% param(BW = body_weight),
                e      = ev(amt = dose * body_weight, time = 0,
                            ii = interval, addl = addl_dose),
                nid    = tot_id,
                tgrid  = tgrid(start = 0, end = 24, delta = delta),
                output = "df")
  
  rows24  <- out$time == 24
  auc_vec <- out$cAUC[rows24]

  list(sim = transform(out, regimen = label),
       auc = data.frame(regimen = label, AUC_0_24 = auc_vec))}
```

```{r}
#| eval: false
res1 <- run_regimen(dose1, BWmedian, 24, 0, "3.95 mg/kg q24h")
res2 <- run_regimen(dose1, BWmedian, 12, 1, "3.95 mg/kg q12h")
res3 <- run_regimen(dose1, BWmedian,  8, 2, "3.95 mg/kg q8h")
res4 <- run_regimen(dose2, BWmedian, 24, 0, "6.32 mg/kg q24h")
res5 <- run_regimen(8,     BWmedian, 24, 0, "8.00 mg/kg q24h")
res6 <- run_regimen(9.50,  BWmedian, 24, 0, "9.50 mg/kg q24h")
```

{{< pagebreak >}}

```{r}
#| eval: false
auc_all <- bind_rows(res1$auc, res2$auc, res3$auc,
                     res4$auc, res5$auc, res6$auc)
```

```{r}
#| eval: false
##| label: tbl-AUC1
##| tbl-cap: "AUC (0–24 h, in mg·h/L) Summary by Regimen for Median
##            BW of 38 kg."
auc_summary <- auc_all %>%
  group_by(regimen) %>%
  summarize(median_AUC_0_24 = median(AUC_0_24),
            mean_AUC_0_24   = mean(AUC_0_24),
            sd_AUC_0_24     = sd(AUC_0_24),
            PTA             = mean(AUC_0_24 >= 28) * 100,
            .groups = "drop")

auc_summary %>%
  kable(format   = "latex", # PDF/LaTeX output
        booktabs = TRUE,    # nicer horizontal rules
        digits   = 4,       # numeric rounding
        col.names = c("Regimen", "Median", "Mean", "SD", "PTA (%)"),
        align    = c("l", "r", "r", "r", "r"),
        longtable = TRUE)
```

```{r}
#| eval: false
##| label: tbl-AUC2
##| tbl-cap: "AUC (0–24 h, in mg·h/L) Summary by BW for 9.50 mg/kg q24h."
res6 <- res6 %>% map(~ .x %>%
  mutate(regimen = recode(regimen, "9.50 mg/kg q24h" = "38 (median)")))

res7 <- run_regimen(9.50, BWmin, 24, 0, "24 (min)")
res8 <- run_regimen(9.50, BWmax, 24, 0, "75 (max)")

sim_BW <- bind_rows(res6$sim, res7$sim, res8$sim)
auc_BW <- bind_rows(res6$auc, res7$auc, res8$auc)

auc_BW <- auc_BW %>% 
  mutate(dose_BW = case_when(regimen == "38 (median)" ~ 38,
                             regimen == "24 (min)" ~ 24,
                             regimen == "75 (max)" ~ 75))

auc_BW$dose_BW = auc_BW$dose_BW * 9.50
```

{{< pagebreak >}}

```{r}
#| eval: false
auc_summary <- auc_BW %>%
  group_by(regimen) %>%
  summarize(actual_dose = unique(dose_BW),
            median_AUC_0_24 = median(AUC_0_24),
            mean_AUC_0_24   = mean(AUC_0_24),
            sd_AUC_0_24     = sd(AUC_0_24),
            PTA             = mean(AUC_0_24 >= 28) * 100,
            .groups = "drop")

auc_summary %>%
  kable(format   = "latex", booktabs = TRUE, digits   = 4,
        col.names = c("Body Weight (kg)", "Dose (mg)", "Median",
                      "Mean", "SD", "PTA (%)"),
        align    = c("l", "r", "r", "r", "r", "r"),
        longtable = TRUE)
```

```{r}
#| eval: false
ipred_summary <- sim_BW %>%
  group_by(regimen, time) %>%
  summarize(IPRED_median = median(IPRED),
            IPRED_lo     = quantile(IPRED, 0.05),
            IPRED_hi     = quantile(IPRED, 0.95),
            .groups = "drop")
```
```{r}
#| eval: false
ggplot(ipred_summary, aes(x = time, color = regimen)) +
  geom_ribbon(aes(ymin = IPRED_lo, ymax = IPRED_hi, fill = regimen),
              alpha = 0.15, color = NA)+
  geom_line(aes(y = IPRED_median), linewidth = 1) +
  scale_color_manual(values = c("red", "forestgreen", "blue")) +
  scale_fill_manual(values =  c("red", "forestgreen", "blue")) +
  guides(fill="none") +
  labs(x = "Time (h)",
       y = "Individual Predicted Concentration (mg/L)",
       color = "Body Weight (kg)") +
  theme_minimal()

ggsave("C_p_plots_regimens.png", width = 6.8, height = 3.7,
       dpi = 300, units = "in")
```
