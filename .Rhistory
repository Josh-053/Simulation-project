mutate(EVID = ifelse(RATE==0,0,1),
EVID = ifelse(TIME=!0 & RATE=!0, 4, EVID),
data %>%
mutate(EVID = ifelse(RATE==0,0,1),
EVID = ifelse(TIME!=0 & RATE!=0, 4, EVID),
EVID = ifelse(TIME!+0 & RATE==0, 2, EVID))
data$MDV = 0
data %>%
mutate(EVID = ifelse(RATE==0,0,1),
EVID = ifelse(TIME!=0 & RATE!=0, 4, EVID),
EVID = ifelse(TIME!=0 & RATE==0, 2, EVID))
data$MDV = 0
data <- data %>%
mutate(EVID = ifelse(RATE==0,0,1),
EVID = ifelse(TIME!=0 & RATE!=0, 4, EVID),
EVID = ifelse(TIME!=0 & RATE==0, 2, EVID))
data <- read.table("/home/ali/Desktop/Modeling/Project/MOD_Exam_2526_Dataset.txt",
sep = " ",        # space-separated
na.strings = ".", # treat "." as NA
header = TRUE)
data$MDV = 0
data$MDV = 0
data <- data %>%
mutate(EVID = ifelse(RATE==0,0,1),
EVID = ifelse(TIME!=0 & RATE!=0, 4, EVID),
EVID = ifelse(TIME!=0 & DV==is.na(), 2, EVID))
data$MDV = 0
data <- data %>%
mutate(EVID = ifelse(RATE==0,0,1),
EVID = ifelse(TIME!=0 & RATE!=0, 4, EVID),
EVID = ifelse(TIME!=0 & CONC==is.na(), 2, EVID))
data <- data %>%
mutate(EVID = ifelse(RATE==0,0,1))
data <- read.table("/home/ali/Desktop/Modeling/Project/MOD_Exam_2526_Dataset.txt",
sep = " ",        # space-separated
na.strings = ".", # treat "." as NA
header = TRUE)
data$MDV = 0
data <- data %>%
mutate(EVID = ifelse(RATE==0,0,1),
EVID = ifelse(TIME>0 & RATE!=0 & DOSE>0, 4, EVID))
data <- read.table("/home/ali/Desktop/Modeling/Project/MOD_Exam_2526_Dataset.txt",
sep = " ",        # space-separated
na.strings = ".", # treat "." as NA
header = TRUE)
data$MDV = 0
data <- data %>%
mutate(EVID = ifelse(RATE==0,0,1),
EVID = ifelse(TIME>0 & RATE!=0 & DOSE>0, 4, EVID),
EVID = ifelse(DUMMY==1, 2, EVID))
write.table(data, file = "/home/ali/Desktop/Modeling/Project/MOD_Exam_2526_Dataset.txt", quote = FALSE, sep = " ", na = ".")
data <- data %>%
mutate(EVID = ifelse(RATE==0,0,1),
EVID = ifelse(DUMMY==1, 2, EVID))
write.table(data, file = "/home/ali/Desktop/Modeling/Project/MOD_Exam_2526_Dataset.txt", quote = FALSE, sep = " ", na = ".")
data2 <- data %>%  group_by(ID) %>%
fill(c(Bw),.direction = "down") %>%
ungroup()
data2 <- data %>%  group_by(ID) %>%
fill(c(BW),.direction = "down") %>%
ungroup()
View(data2)
data2 <- data %>%  group_by(ID) %>%
fill(c(BW),.direction = "downup") %>%
ungroup()
data <- data %>%  group_by(ID) %>%
fill(c(BW),.direction = "downup") %>%
ungroup()
data <- data %>%
mutate(EVID = ifelse(RATE==0,0,1),
EVID = ifelse(DUMMY==1, 2, EVID),
MDV = ifelse(DUMMY==1,1,MDV),
MDV = ifelse(RATE!=0,1,MDV))
data$AMT = data$DOSE * data$BW
write.table(data, file = "/home/ali/Desktop/Modeling/Project/MOD_Exam_2526_Dataset.txt", quote = FALSE, sep = " ", na = ".")
gc()
gc()
#| include: false
if (!require("pacman")) {
install.packages("pacman")
library(pacman)}
pacman::p_load(mrgsolve,
ggplot2,
kableExtra,
tidyverse,
patchwork,
xpose,
vpc)
#| echo: false
mod <- mread("project")
#| echo: false
set.seed(123)      # reproducibility
N      <- 100L     # number of replicates
N_id   <- 33L      # number of patients per replicate
delta  <- 0.1      # hours (h)
tot_id <- N * N_id
#| echo: false
ev1 <- ev(amt = 150, time = 0)
ev2 <- ev(amt = 150, time = 0, ii = 12, addl = 1)
ev3 <- ev(amt = 150, time = 0, ii = 8,  addl = 2)
ev4 <- ev(amt = 200, time = 0)
ev5 <- ev(amt = 240, time = 0)
ev6 <- ev(amt = 300, time = 0)
# Force a grid that includes 24 exactly
tg <- tgrid(start = 0, end = 24, delta = delta)
run_regimen <- function(ev_obj, label) {
out <- mrgsim(mod %>% init(cAUC = 0),
e      = ev_obj,
nid    = tot_id,
tgrid  = tg,
output = "df")
rows24  <- out$time == 24
auc_vec <- out$cAUC[rows24]
# Robustness check: should have one AUC per ID
stopifnot(length(auc_vec) == tot_id)
list(sim = transform(out, regimen = label),
auc = data.frame(regimen = label, AUC_0_24 = auc_vec))
}
#| echo: false
res_24_150 <- run_regimen(ev1, "150 mg q24h")
res_12_150 <- run_regimen(ev2, "150 mg q12h")
res_08_150 <- run_regimen(ev3, "150 mg q8h")
res_24_200 <- run_regimen(ev4, "200 mg q24h")
res_24_240 <- run_regimen(ev5, "240 mg q24h")
res_24_300 <- run_regimen(ev6, "300 mg q24h")
sim_all <- bind_rows(res_24_150$sim, res_12_150$sim, res_08_150$sim,
res_24_200$sim, res_24_240$sim, res_24_300$sim)
auc_all <- bind_rows(res_24_150$auc, res_12_150$auc, res_08_150$auc,
res_24_200$auc, res_24_240$auc, res_24_300$auc)
#| echo: false
auc_summary <- auc_all %>%
group_by(regimen) %>%
summarize(median_AUC_0_24 = median(AUC_0_24),
mean_AUC_0_24   = mean(AUC_0_24),
sd_AUC_0_24     = sd(AUC_0_24),
.groups = "drop")
auc_summary %>%
kable(
format   = "latex", # PDF/LaTeX output
booktabs = TRUE,    # nicer horizontal rules
digits   = 2,       # numeric rounding
caption  = "AUC (0–24 h) Summary by Regimen",
col.names = c("Regimen", "Median", "Mean", "SD"),
align    = c("l", "r", "r", "r"),
longtable = TRUE
)
#| echo: false
ipred_summary<- sim_all %>%
group_by(regimen, time) %>%
summarize(IPRED_median = median(IPRED),
IPRED_lo     = quantile(IPRED, 0.025),
IPRED_hi     = quantile(IPRED, 0.975),
.groups = "drop")
ggplot(ipred_summary,
aes(x = time,
color = regimen)) +
geom_ribbon(aes(ymin = IPRED_lo,
ymax = IPRED_hi,
fill = regimen),
alpha = 0.15,
color = NA)+
geom_line(aes(y = IPRED_median),
linewidth = 1) +
scale_color_manual(values = c("red", "darkorange", "gold",
"forestgreen", "blue", "purple")) +
scale_fill_manual(values =  c("red", "darkorange", "gold",
"forestgreen", "blue", "purple")) +
guides(fill="none") +
labs(
title = "Regimen comparison: IPRED median profiles",
x = "Time (h)",
y = "Concentration (IPRED)",
color = "Regimen") +
theme_minimal()
ggsave("C_p_plots_regimens.png")
#| echo: false
ipred_summary<- sim_all %>%
group_by(regimen, time) %>%
summarize(IPRED_median = median(IPRED),
IPRED_lo     = quantile(IPRED, 0.05),
IPRED_hi     = quantile(IPRED, 0.95),
.groups = "drop")
ggplot(ipred_summary,
aes(x = time,
color = regimen)) +
geom_ribbon(aes(ymin = IPRED_lo,
ymax = IPRED_hi,
fill = regimen),
alpha = 0.15,
color = NA)+
geom_line(aes(y = IPRED_median),
linewidth = 1) +
scale_color_manual(values = c("red", "darkorange", "gold",
"forestgreen", "blue", "purple")) +
scale_fill_manual(values =  c("red", "darkorange", "gold",
"forestgreen", "blue", "purple")) +
guides(fill="none") +
labs(
title = "Regimen comparison: IPRED median profiles",
x = "Time (h)",
y = "Concentration (IPRED)",
color = "Regimen") +
theme_minimal()
ggsave("C_p_plots_regimens.png")
#| include: false
ipred_summary<- sim_all %>%
group_by(regimen, time) %>%
summarize(IPRED_median = median(IPRED),
IPRED_lo     = quantile(IPRED, 0.05),
IPRED_hi     = quantile(IPRED, 0.95),
.groups = "drop")
ggplot(ipred_summary,
aes(x = time,
color = regimen)) +
geom_ribbon(aes(ymin = IPRED_lo,
ymax = IPRED_hi,
fill = regimen),
alpha = 0.15,
color = NA)+
geom_line(aes(y = IPRED_median),
linewidth = 1) +
scale_color_manual(values = c("red", "darkorange", "gold",
"forestgreen", "blue", "purple")) +
scale_fill_manual(values =  c("red", "darkorange", "gold",
"forestgreen", "blue", "purple")) +
guides(fill="none") +
labs(
title = "Regimen comparison: IPRED median profiles",
x = "Time (h)",
y = "Concentration (IPRED)",
color = "Regimen") +
theme_minimal()
ggsave("C_p_plots_regimens.png")
#| include: false
ipred_summary<- sim_all %>%
group_by(regimen, time) %>%
summarize(IPRED_median = median(IPRED),
IPRED_lo     = quantile(IPRED, 0.05),
IPRED_hi     = quantile(IPRED, 0.95),
.groups = "drop")
ggplot(ipred_summary,
aes(x = time,
color = regimen)) +
geom_ribbon(aes(ymin = IPRED_lo,
ymax = IPRED_hi,
fill = regimen),
alpha = 0.15,
color = NA)+
geom_line(aes(y = IPRED_median),
linewidth = 1) +
scale_color_manual(values = c("red", "darkorange", "gold",
"forestgreen", "blue", "purple")) +
scale_fill_manual(values =  c("red", "darkorange", "gold",
"forestgreen", "blue", "purple")) +
guides(fill="none") +
labs(x = "Time (h)",
y = "Concentration (IPRED)",
color = "Regimen") +
theme_minimal()
ggsave("C_p_plots_regimens.png")
knitr::knit_engines$set(cpp
)
#| include: false
if (!require("pacman")) {
install.packages("pacman")
library(pacman)}
pacman::p_load(mrgsolve,
ggplot2,
kableExtra,
tidyverse,
patchwork)
#| echo: false
mod <- mread("project")
#| echo: false
set.seed(123)      # reproducibility
N      <- 100L     # number of replicates
N_id   <- 33L      # number of patients per replicate
delta  <- 0.1      # hours (h)
tot_id <- N * N_id
#| echo: false
ev1 <- ev(amt = 150, time = 0)
ev2 <- ev(amt = 150, time = 0, ii = 12, addl = 1)
ev3 <- ev(amt = 150, time = 0, ii = 8,  addl = 2)
ev4 <- ev(amt = 240, time = 0)
ev5 <- ev(amt = 300, time = 0)
ev6 <- ev(amt = 360, time = 0)
# Force a grid that includes 24 exactly
tg <- tgrid(start = 0, end = 24, delta = delta)
run_regimen <- function(ev_obj, label) {
out <- mrgsim(mod %>% init(cAUC = 0),
e      = ev_obj,
nid    = tot_id,
tgrid  = tg,
output = "df")
rows24  <- out$time == 24
auc_vec <- out$cAUC[rows24]
# Robustness check: should have one AUC per ID
stopifnot(length(auc_vec) == tot_id)
list(sim = transform(out, regimen = label),
auc = data.frame(regimen = label, AUC_0_24 = auc_vec))
}
#| echo: false
res_24_150 <- run_regimen(ev1, "150 mg q24h")
res_12_150 <- run_regimen(ev2, "150 mg q12h")
res_08_150 <- run_regimen(ev3, "150 mg q8h")
res_24_240 <- run_regimen(ev4, "240 mg q24h")
res_24_300 <- run_regimen(ev5, "300 mg q24h")
res_24_360 <- run_regimen(ev6, "360 mg q24h")
sim_all <- bind_rows(res_24_150$sim, res_12_150$sim, res_08_150$sim,
res_24_240$sim, res_24_300$sim, res_24_360$sim)
auc_all <- bind_rows(res_24_150$auc, res_12_150$auc, res_08_150$auc,
res_24_240$auc, res_24_300$auc, res_24_360$auc)
#| echo: false
auc_summary <- auc_all %>%
group_by(regimen) %>%
summarize(median_AUC_0_24 = median(AUC_0_24),
mean_AUC_0_24   = mean(AUC_0_24),
sd_AUC_0_24     = sd(AUC_0_24),
PTA             = mean(AUC_0_24 >= 28) * 100,
.groups = "drop")
auc_summary %>%
kable(
format   = "latex", # PDF/LaTeX output
booktabs = TRUE,    # nicer horizontal rules
digits   = 2,       # numeric rounding
caption  = "AUC (0–24 h) Summary by Regimen",
col.names = c("Regimen", "Median", "Mean", "SD", "PTA (%)"),
align    = c("l", "r", "r", "r", "r"),
longtable = TRUE
)
#| include: false
ipred_summary<- sim_all %>%
group_by(regimen, time) %>%
summarize(IPRED_median = median(IPRED),
IPRED_lo     = quantile(IPRED, 0.05),
IPRED_hi     = quantile(IPRED, 0.95),
.groups = "drop")
ggplot(ipred_summary,
aes(x = time,
color = regimen)) +
geom_ribbon(aes(ymin = IPRED_lo,
ymax = IPRED_hi,
fill = regimen),
alpha = 0.15,
color = NA)+
geom_line(aes(y = IPRED_median),
linewidth = 1) +
scale_color_manual(values = c("red", "darkorange", "gold",
"forestgreen", "blue", "purple")) +
scale_fill_manual(values =  c("red", "darkorange", "gold",
"forestgreen", "blue", "purple")) +
guides(fill="none") +
labs(x = "Time (h)",
y = "Concentration (IPRED)",
color = "Regimen") +
theme_minimal()
ggsave("C_p_plots_regimens.png")
#| include: false
ipred_summary<- sim_all %>%
group_by(regimen, time) %>%
summarize(IPRED_median = median(IPRED),
IPRED_lo     = quantile(IPRED, 0.05),
IPRED_hi     = quantile(IPRED, 0.95),
.groups = "drop")
ggplot(ipred_summary,
aes(x = time,
color = regimen)) +
geom_ribbon(aes(ymin = IPRED_lo,
ymax = IPRED_hi,
fill = regimen),
alpha = 0.15,
color = NA)+
geom_line(aes(y = IPRED_median),
linewidth = 1) +
scale_color_manual(values = c("red", "darkorange", "gold",
"forestgreen", "blue", "purple")) +
scale_fill_manual(values =  c("red", "darkorange", "gold",
"forestgreen", "blue", "purple")) +
guides(fill="none") +
labs(x = "Time (h)",
y = "Concentration (IPRED)",
color = "Regimen") +
theme_minimal()
ggsave("C_p_plots_regimens.png")
#| echo: false
ipred_summary<- sim_all %>%
group_by(regimen, time) %>%
summarize(IPRED_median = median(IPRED),
IPRED_lo     = quantile(IPRED, 0.05),
IPRED_hi     = quantile(IPRED, 0.95),
.groups = "drop")
ggplot(ipred_summary,
aes(x = time,
color = regimen)) +
geom_ribbon(aes(ymin = IPRED_lo,
ymax = IPRED_hi,
fill = regimen),
alpha = 0.15,
color = NA)+
geom_line(aes(y = IPRED_median),
linewidth = 1) +
scale_color_manual(values = c("red", "darkorange", "gold",
"forestgreen", "blue", "purple")) +
scale_fill_manual(values =  c("red", "darkorange", "gold",
"forestgreen", "blue", "purple")) +
guides(fill="none") +
labs(x = "Time (h)",
y = "Concentration (IPRED)",
color = "Regimen") +
theme_minimal()
ggsave("C_p_plots_regimens.png")
gc()
gc()
#| include: false
if (!require("pacman")) {
install.packages("pacman")
library(pacman)}
pacman::p_load(mrgsolve,
ggplot2,
kableExtra,
tidyverse,
patchwork)
#| echo: false
mod <- mread("project")
#| echo: false
set.seed(123)      # reproducibility
N      <- 100L     # number of replicates
N_id   <- 33L      # number of patients per replicate
delta  <- 0.1      # hours (h)
tot_id <- N * N_id
#| echo: false
ev1 <- ev(amt = 150, time = 0)
ev2 <- ev(amt = 150, time = 0, ii = 12, addl = 1)
ev3 <- ev(amt = 150, time = 0, ii = 8,  addl = 2)
ev4 <- ev(amt = 240, time = 0)
ev5 <- ev(amt = 300, time = 0)
ev6 <- ev(amt = 330, time = 0)
# Force a grid that includes 24 exactly
tg <- tgrid(start = 0, end = 24, delta = delta)
run_regimen <- function(ev_obj, label) {
out <- mrgsim(mod %>% init(cAUC = 0),
e      = ev_obj,
nid    = tot_id,
tgrid  = tg,
output = "df")
rows24  <- out$time == 24
auc_vec <- out$cAUC[rows24]
# Robustness check: should have one AUC per ID
stopifnot(length(auc_vec) == tot_id)
list(sim = transform(out, regimen = label),
auc = data.frame(regimen = label, AUC_0_24 = auc_vec))
}
#| echo: false
res_24_150 <- run_regimen(ev1, "150 mg q24h")
res_12_150 <- run_regimen(ev2, "150 mg q12h")
res_08_150 <- run_regimen(ev3, "150 mg q8h")
res_24_240 <- run_regimen(ev4, "240 mg q24h")
res_24_300 <- run_regimen(ev5, "300 mg q24h")
res_24_330 <- run_regimen(ev6, "330 mg q24h")
sim_all <- bind_rows(res_24_150$sim, res_12_150$sim, res_08_150$sim,
res_24_240$sim, res_24_300$sim, res_24_330$sim)
auc_all <- bind_rows(res_24_150$auc, res_12_150$auc, res_08_150$auc,
res_24_240$auc, res_24_300$auc, res_24_330$auc)
#| echo: false
auc_summary <- auc_all %>%
group_by(regimen) %>%
summarize(median_AUC_0_24 = median(AUC_0_24),
mean_AUC_0_24   = mean(AUC_0_24),
sd_AUC_0_24     = sd(AUC_0_24),
PTA             = mean(AUC_0_24 >= 28) * 100,
.groups = "drop")
auc_summary %>%
kable(
format   = "latex", # PDF/LaTeX output
booktabs = TRUE,    # nicer horizontal rules
digits   = 2,       # numeric rounding
caption  = "AUC (0–24 h, in mg·h/L) Summary by Regimen",
col.names = c("Regimen", "Median", "Mean", "SD", "PTA (%)"),
align    = c("l", "r", "r", "r", "r"),
longtable = TRUE
)
#| include: false
ipred_summary<- sim_all %>%
group_by(regimen, time) %>%
summarize(IPRED_median = median(IPRED),
IPRED_lo     = quantile(IPRED, 0.05),
IPRED_hi     = quantile(IPRED, 0.95),
.groups = "drop")
ggplot(ipred_summary,
aes(x = time,
color = regimen)) +
geom_ribbon(aes(ymin = IPRED_lo,
ymax = IPRED_hi,
fill = regimen),
alpha = 0.15,
color = NA)+
geom_line(aes(y = IPRED_median),
linewidth = 1) +
scale_color_manual(values = c("red", "darkorange", "gold",
"forestgreen", "blue", "purple")) +
scale_fill_manual(values =  c("red", "darkorange", "gold",
"forestgreen", "blue", "purple")) +
guides(fill="none") +
labs(x = "Time (h)",
y = "Concentration (IPRED)",
color = "Regimen") +
theme_minimal()
ggsave("C_p_plots_regimens.png", width = 6.8, height = 3.8, dpi = 300, units = "in")
median(auc_all$AUC_0_24[auc_all$regimen=="150 mg q24h"])
signif(median(auc_all$AUC_0_24[auc_all$regimen=="150 mg q24h"], digits = 4)
)
signif(median(auc_all$AUC_0_24[auc_all$regimen=="150 mg q24h"], digits = 2))
