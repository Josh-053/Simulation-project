"forestgreen", "blue", "purple")) +
scale_fill_manual(values =  c("red", "darkorange", "gold",
"forestgreen", "blue", "purple")) +
guides(fill="none") +
labs(x = "Time (h)",
y = "Concentration (IPRED)",
color = "Regimen") +
theme_minimal()
ggsave("C_p_plots_regimens.png")
#| echo: false
ipred_summary<- sim_all %>%
group_by(regimen, time) %>%
summarize(IPRED_median = median(IPRED),
IPRED_lo     = quantile(IPRED, 0.05),
IPRED_hi     = quantile(IPRED, 0.95),
.groups = "drop")
ggplot(ipred_summary,
aes(x = time,
color = regimen)) +
geom_ribbon(aes(ymin = IPRED_lo,
ymax = IPRED_hi,
fill = regimen),
alpha = 0.15,
color = NA)+
geom_line(aes(y = IPRED_median),
linewidth = 1) +
scale_color_manual(values = c("red", "darkorange", "gold",
"forestgreen", "blue", "purple")) +
scale_fill_manual(values =  c("red", "darkorange", "gold",
"forestgreen", "blue", "purple")) +
guides(fill="none") +
labs(x = "Time (h)",
y = "Concentration (IPRED)",
color = "Regimen") +
theme_minimal()
ggsave("C_p_plots_regimens.png")
gc()
gc()
#| include: false
if (!require("pacman")) {
install.packages("pacman")
library(pacman)}
pacman::p_load(mrgsolve,
ggplot2,
kableExtra,
tidyverse,
patchwork)
#| echo: false
mod <- mread("project")
#| echo: false
set.seed(123)      # reproducibility
N      <- 100L     # number of replicates
N_id   <- 33L      # number of patients per replicate
delta  <- 0.1      # hours (h)
tot_id <- N * N_id
#| echo: false
ev1 <- ev(amt = 150, time = 0)
ev2 <- ev(amt = 150, time = 0, ii = 12, addl = 1)
ev3 <- ev(amt = 150, time = 0, ii = 8,  addl = 2)
ev4 <- ev(amt = 240, time = 0)
ev5 <- ev(amt = 300, time = 0)
ev6 <- ev(amt = 330, time = 0)
# Force a grid that includes 24 exactly
tg <- tgrid(start = 0, end = 24, delta = delta)
run_regimen <- function(ev_obj, label) {
out <- mrgsim(mod %>% init(cAUC = 0),
e      = ev_obj,
nid    = tot_id,
tgrid  = tg,
output = "df")
rows24  <- out$time == 24
auc_vec <- out$cAUC[rows24]
# Robustness check: should have one AUC per ID
stopifnot(length(auc_vec) == tot_id)
list(sim = transform(out, regimen = label),
auc = data.frame(regimen = label, AUC_0_24 = auc_vec))
}
#| echo: false
res_24_150 <- run_regimen(ev1, "150 mg q24h")
res_12_150 <- run_regimen(ev2, "150 mg q12h")
res_08_150 <- run_regimen(ev3, "150 mg q8h")
res_24_240 <- run_regimen(ev4, "240 mg q24h")
res_24_300 <- run_regimen(ev5, "300 mg q24h")
res_24_330 <- run_regimen(ev6, "330 mg q24h")
sim_all <- bind_rows(res_24_150$sim, res_12_150$sim, res_08_150$sim,
res_24_240$sim, res_24_300$sim, res_24_330$sim)
auc_all <- bind_rows(res_24_150$auc, res_12_150$auc, res_08_150$auc,
res_24_240$auc, res_24_300$auc, res_24_330$auc)
#| echo: false
auc_summary <- auc_all %>%
group_by(regimen) %>%
summarize(median_AUC_0_24 = median(AUC_0_24),
mean_AUC_0_24   = mean(AUC_0_24),
sd_AUC_0_24     = sd(AUC_0_24),
PTA             = mean(AUC_0_24 >= 28) * 100,
.groups = "drop")
auc_summary %>%
kable(
format   = "latex", # PDF/LaTeX output
booktabs = TRUE,    # nicer horizontal rules
digits   = 2,       # numeric rounding
caption  = "AUC (0–24 h, in mg·h/L) Summary by Regimen",
col.names = c("Regimen", "Median", "Mean", "SD", "PTA (%)"),
align    = c("l", "r", "r", "r", "r"),
longtable = TRUE
)
#| include: false
ipred_summary<- sim_all %>%
group_by(regimen, time) %>%
summarize(IPRED_median = median(IPRED),
IPRED_lo     = quantile(IPRED, 0.05),
IPRED_hi     = quantile(IPRED, 0.95),
.groups = "drop")
ggplot(ipred_summary,
aes(x = time,
color = regimen)) +
geom_ribbon(aes(ymin = IPRED_lo,
ymax = IPRED_hi,
fill = regimen),
alpha = 0.15,
color = NA)+
geom_line(aes(y = IPRED_median),
linewidth = 1) +
scale_color_manual(values = c("red", "darkorange", "gold",
"forestgreen", "blue", "purple")) +
scale_fill_manual(values =  c("red", "darkorange", "gold",
"forestgreen", "blue", "purple")) +
guides(fill="none") +
labs(x = "Time (h)",
y = "Concentration (IPRED)",
color = "Regimen") +
theme_minimal()
ggsave("C_p_plots_regimens.png", width = 6.8, height = 3.8, dpi = 300, units = "in")
median(auc_all$AUC_0_24[auc_all$regimen=="150 mg q24h"])
signif(median(auc_all$AUC_0_24[auc_all$regimen=="150 mg q24h"], digits = 4)
)
signif(median(auc_all$AUC_0_24[auc_all$regimen=="150 mg q24h"], digits = 2))
quarto::quarto_render
quarto::quarto_render(Project_report.qmd)
quarto::quarto_render("Project_report.qmd")
rmarkdown::pandoc_version()
system("pandoc --version")
#| include: false
if (!require("pacman")) {
install.packages("pacman")
library(pacman)}
pacman::p_load(mrgsolve,
ggplot2,
kableExtra,
tidyverse)
#| include: false
mod <- mread("project")
#| include: false
if (!require("pacman")) {
install.packages("pacman")
library(pacman)}
pacman::p_load(mrgsolve,
ggplot2,
kableExtra,
tidyverse)
#| include: false
mod <- mread("project")
#| include: false
if (!require("pacman")) {
install.packages("pacman")
library(pacman)}
pacman::p_load(mrgsolve,
ggplot2,
kableExtra,
tidyverse)
#| include: false
mod <- mread("project")
#| include: false
set.seed(123)      # reproducibility
N      <- 100L     # number of replicates
N_id   <- 33L      # number of patients per replicate
delta  <- 0.1      # hours (h)
tot_id <- N * N_id
#| include: false
ev1 <- ev(amt = 150, time = 0)
ev2 <- ev(amt = 150, time = 0, ii = 12, addl = 1)
ev3 <- ev(amt = 150, time = 0, ii = 8,  addl = 2)
ev4 <- ev(amt = 240, time = 0)
ev5 <- ev(amt = 300, time = 0)
ev6 <- ev(amt = 340, time = 0)
# Force a grid that includes 24 exactly
tg <- tgrid(start = 0, end = 24, delta = delta)
run_regimen <- function(ev_obj, label) {
out <- mrgsim(mod %>% init(cAUC = 0),
e      = ev_obj,
nid    = tot_id,
tgrid  = tg,
output = "df")
rows24  <- out$time == 24
auc_vec <- out$cAUC[rows24]
# Robustness check: should have one AUC per ID
stopifnot(length(auc_vec) == tot_id)
list(sim = transform(out, regimen = label),
auc = data.frame(regimen = label, AUC_0_24 = auc_vec))
}
#| include: false
res_24_150 <- run_regimen(ev1, "150 mg q24h")
res_12_150 <- run_regimen(ev2, "150 mg q12h")
res_08_150 <- run_regimen(ev3, "150 mg q8h")
res_24_240 <- run_regimen(ev4, "240 mg q24h")
res_24_300 <- run_regimen(ev5, "300 mg q24h")
res_24_340 <- run_regimen(ev6, "340 mg q24h")
sim_all <- bind_rows(res_24_150$sim, res_12_150$sim, res_08_150$sim,
res_24_240$sim, res_24_300$sim, res_24_340$sim)
auc_all <- bind_rows(res_24_150$auc, res_12_150$auc, res_08_150$auc,
res_24_240$auc, res_24_300$auc, res_24_340$auc)
#| echo: false
#| label: tbl-AUC
#| tbl-cap: "AUC (0–24 h, in mg·h/L) Summary by Regimen"
auc_summary <- auc_all %>%
group_by(regimen) %>%
summarize(median_AUC_0_24 = median(AUC_0_24),
mean_AUC_0_24   = mean(AUC_0_24),
sd_AUC_0_24     = sd(AUC_0_24),
PTA             = mean(AUC_0_24 >= 28) * 100,
.groups = "drop")
auc_summary %>%
kable(
format   = "latex", # PDF/LaTeX output
booktabs = TRUE,    # nicer horizontal rules
digits   = 4,       # numeric rounding
col.names = c("Regimen", "Median", "Mean", "SD", "PTA (%)"),
align    = c("l", "r", "r", "r", "r"),
longtable = TRUE
)
#| include: false
ipred_summary<- sim_all %>%
group_by(regimen, time) %>%
summarize(IPRED_median = median(IPRED),
IPRED_lo     = quantile(IPRED, 0.05),
IPRED_hi     = quantile(IPRED, 0.95),
.groups = "drop")
ggplot(ipred_summary,
aes(x = time,
color = regimen)) +
geom_ribbon(aes(ymin = IPRED_lo,
ymax = IPRED_hi,
fill = regimen),
alpha = 0.15,
color = NA)+
geom_line(aes(y = IPRED_median),
linewidth = 1) +
scale_color_manual(values = c("red", "darkorange", "gold",
"forestgreen", "blue", "purple")) +
scale_fill_manual(values =  c("red", "darkorange", "gold",
"forestgreen", "blue", "purple")) +
guides(fill="none") +
labs(x = "Time (h)",
y = "Concentration (IPRED)",
color = "Regimen") +
theme_minimal()
ggsave("C_p_plots_regimens.png", width = 6.8, height = 3.7, dpi = 300, units = "in")
# administered dose = 150 mg, assume taken in by a child with median BW = 38 kg
dose1 = 150 / 38
# administered dose = 150 mg, assume taken in by a child with median BW = 38 kg
dose1 = 150 / 38
dose2 = 240 / 38
dose3 = 340 / 38
dose4 = 500 / 38
# given in supplementary data: median and range of BW (kg)
BWmin = 24
BWmedian = 38
BWmax = 75
# administered dose = 150 mg, assume taken in by a child with median BW = 38 kg
amt1 = 150
amt2 = 240
amt3 = 300
amt4 = 340
# dose normalized by body weight
dose1 = amt1 / BWmedian
dose2 = amt2 / BWmedian
dose3 = amt3 / BWmedian
dose4 = amt4 / BWmedian
#| include: false
if (!require("pacman")) {
install.packages("pacman")
library(pacman)}
pacman::p_load(mrgsolve,
ggplot2,
kableExtra,
tidyverse)
#| include: false
mod <- mread("project")
set.seed(123)      # reproducibility
N      <- 100L     # number of replicates
N_id   <- 48L      # number of patients per replicate
delta  <- 0.1      # hours (h)
tot_id <- N * N_id
#| include: false
# given in supplementary data: median and range of BW (kg)
BWmin = 24
BWmedian = 38
BWmax = 75
# administered dose = 150 mg, taken in by a patient with median BW = 38 kg
amt1 = 150
# dose normalized by body weight
dose1 = amt1 / BWmedian
dose2 = dose1 / 17.61 * 28 # dose proportionality, determined for BWmedian
run_regimen <- function(dose, body_weight, interval, addl_dose, label) {
out <- mrgsim(mod %>% init(cAUC = 0) %>% param(BW = body_weight),
e      = ev(amt = dose * body_weight, time = 0,
ii = interval, addl = addl_dose),
nid    = tot_id,
tgrid  = tgrid(start = 0, end = 24, delta = delta),
output = "df")
rows24  <- out$time == 24
auc_vec <- out$cAUC[rows24]
stopifnot(length(auc_vec) == tot_id) # Robustness check: one AUC per ID!
list(sim = transform(out, regimen = label),
auc = data.frame(regimen = label, AUC_0_24 = auc_vec))
}
#| include: false
res1 <- run_regimen(dose1, BWmedian, 24, 0, "3.95 mg/kg q24h")
res2 <- run_regimen(dose1, BWmedian, 12, 1, "3.95 mg/kg q12h")
res3 <- run_regimen(dose1, BWmedian,  8, 2, "3.95 mg/kg q8h")
res4 <- run_regimen(dose2, BWmedian, 24, 0, "6.32 mg/kg q24h")
res5 <- run_regimen(8,     BWmedian, 24, 0, "8.00 mg/kg q24h")
res6 <- run_regimen(9.5,   BWmedian, 24, 0, "9.50 mg/kg q24h")
auc_all <- bind_rows(res1$auc, res2$auc, res3$auc,
res4$auc, res5$auc, res6$auc)
#| echo: false
#| label: tbl-AUC1
#| tbl-cap: "AUC (0–24 h, in mg·h/L) Summary by Regimen for Median Body Weight of 38 kg."
auc_summary <- auc_all %>%
group_by(regimen) %>%
summarize(median_AUC_0_24 = median(AUC_0_24),
mean_AUC_0_24   = mean(AUC_0_24),
sd_AUC_0_24     = sd(AUC_0_24),
PTA             = mean(AUC_0_24 >= 28) * 100,
.groups = "drop")
auc_summary %>%
kable(
format   = "latex", # PDF/LaTeX output
booktabs = TRUE,    # nicer horizontal rules
digits   = 4,       # numeric rounding
col.names = c("Regimen", "Median", "Mean", "SD", "PTA (%)"),
align    = c("l", "r", "r", "r", "r"),
longtable = TRUE
)
View(auc_summary)
#| echo: false
#| label: tbl-AUC2
#| tbl-cap: "AUC (0–24 h, in mg·h/L) Summary by Body Weight for 9.50 mg/kg q24h."
res6 <- run_regimen(9.50, BWmin,    24, 0, "24 kg (min)")
res7 <- run_regimen(9.50, BWmedian, 24, 0, "38 kg (median)")
res8 <- run_regimen(9.50, BWmax,    24, 0, "75 kg (max)")
sim_BW <- bind_rows(res6$sim, res7$sim, res8$sim)
auc_BW <- bind_rows(res6$auc, res7$auc, res8$auc)
auc_summary <- auc_BW %>%
group_by(regimen) %>%
summarize(median_AUC_0_24 = median(AUC_0_24),
mean_AUC_0_24   = mean(AUC_0_24),
sd_AUC_0_24     = sd(AUC_0_24),
PTA             = mean(AUC_0_24 >= 28) * 100,
.groups = "drop")
auc_summary %>%
kable(
format   = "latex", # PDF/LaTeX output
booktabs = TRUE,    # nicer horizontal rules
digits   = 4,       # numeric rounding
col.names = c("Body Weight (kg)", "Median", "Mean", "SD", "PTA (%)"),
align    = c("l", "r", "r", "r", "r"),
longtable = TRUE
)
#| include: false
ipred_summary <- sim_BW %>%
group_by(regimen, time) %>%
summarize(IPRED_median = median(IPRED),
IPRED_lo     = quantile(IPRED, 0.05),
IPRED_hi     = quantile(IPRED, 0.95),
.groups = "drop")
ggplot(ipred_summary,
aes(x = time,
color = regimen)) +
geom_ribbon(aes(ymin = IPRED_lo,
ymax = IPRED_hi,
fill = regimen),
alpha = 0.15,
color = NA)+
geom_line(aes(y = IPRED_median),
linewidth = 1) +
scale_color_manual(values = c("red", "forestgreen", "blue")) +
scale_fill_manual(values =  c("red", "forestgreen", "blue")) +
guides(fill="none") +
labs(x = "Time (h)",
y = "Concentration (IPRED)",
color = "Regimen") +
theme_minimal()
ggsave("C_p_plots_regimens.png", width = 6.8, height = 3.7, dpi = 300, units = "in")
View(res6)
#| echo: false
#| label: tbl-AUC2
#| tbl-cap: "AUC (0–24 h, in mg·h/L) Summary by Body Weight for 9.50 mg/kg q24h."
res6 <- res6 %>% mutate(regimen = ifelse("9.50 mg/kg q24h", "38 (median", regimen))
#| include: false
if (!require("pacman")) {
install.packages("pacman")
library(pacman)}
pacman::p_load(mrgsolve,
ggplot2,
kableExtra,
tidyverse)
#| include: false
mod <- mread("project")
set.seed(123)      # reproducibility
N      <- 100L     # number of replicates
N_id   <- 48L      # number of patients per replicate
delta  <- 0.1      # hours (h)
tot_id <- N * N_id
#| include: false
# given in supplementary data: median and range of BW (kg)
BWmin = 24
BWmedian = 38
BWmax = 75
# administered dose = 150 mg, taken in by a patient with median BW = 38 kg
amt1 = 150
# dose normalized by body weight
dose1 = amt1 / BWmedian
dose2 = dose1 / 17.61 * 28 # dose proportionality, determined for BWmedian
run_regimen <- function(dose, body_weight, interval, addl_dose, label) {
out <- mrgsim(mod %>% init(cAUC = 0) %>% param(BW = body_weight),
e      = ev(amt = dose * body_weight, time = 0,
ii = interval, addl = addl_dose),
nid    = tot_id,
tgrid  = tgrid(start = 0, end = 24, delta = delta),
output = "df")
rows24  <- out$time == 24
auc_vec <- out$cAUC[rows24]
stopifnot(length(auc_vec) == tot_id) # Robustness check: one AUC per ID!
list(sim = transform(out, regimen = label),
auc = data.frame(regimen = label, AUC_0_24 = auc_vec))
}
#| include: false
res1 <- run_regimen(dose1, BWmedian, 24, 0, "3.95 mg/kg q24h")
res2 <- run_regimen(dose1, BWmedian, 12, 1, "3.95 mg/kg q12h")
res3 <- run_regimen(dose1, BWmedian,  8, 2, "3.95 mg/kg q8h")
res4 <- run_regimen(dose2, BWmedian, 24, 0, "6.32 mg/kg q24h")
res5 <- run_regimen(8,     BWmedian, 24, 0, "8.00 mg/kg q24h")
res6 <- run_regimen(9.50,  BWmedian, 24, 0, "9.50 mg/kg q24h")
auc_all <- bind_rows(res1$auc, res2$auc, res3$auc,
res4$auc, res5$auc, res6$auc)
#| echo: false
#| label: tbl-AUC1
#| tbl-cap: "AUC (0–24 h, in mg·h/L) Summary by Regimen for Median Body Weight of 38 kg."
auc_summary <- auc_all %>%
group_by(regimen) %>%
summarize(median_AUC_0_24 = median(AUC_0_24),
mean_AUC_0_24   = mean(AUC_0_24),
sd_AUC_0_24     = sd(AUC_0_24),
PTA             = mean(AUC_0_24 >= 28) * 100,
.groups = "drop")
auc_summary %>%
kable(
format   = "latex", # PDF/LaTeX output
booktabs = TRUE,    # nicer horizontal rules
digits   = 4,       # numeric rounding
col.names = c("Regimen", "Median", "Mean", "SD", "PTA (%)"),
align    = c("l", "r", "r", "r", "r"),
longtable = TRUE
)
#| echo: false
#| label: tbl-AUC2
#| tbl-cap: "AUC (0–24 h, in mg·h/L) Summary by Body Weight for 9.50 mg/kg q24h."
res6 <- res6 %>% mutate(regimen == ifelse("9.50 mg/kg q24h", "38 (median)", regimen))
#| echo: false
#| label: tbl-AUC2
#| tbl-cap: "AUC (0–24 h, in mg·h/L) Summary by Body Weight for 9.50 mg/kg q24h."
res6 <- res6 %>%
mutate(regimen = recode(regimen, "9.50 mg/kg q24h" = "38 (median)")
res7 <- run_regimen(9.50, BWmin, 24, 0, "24 (min)")
#| echo: false
#| label: tbl-AUC2
#| tbl-cap: "AUC (0–24 h, in mg·h/L) Summary by Body Weight for 9.50 mg/kg q24h."
res6 <- res6 %>%
mutate(regimen = recode(regimen, "9.50 mg/kg q24h" = "38 (median)"))
#| echo: false
#| label: tbl-AUC2
#| tbl-cap: "AUC (0–24 h, in mg·h/L) Summary by Body Weight for 9.50 mg/kg q24h."
res6 <- res6 %>%
map(~ .x %>% mutate(regimen = recode(regimen, "9.50 mg/kg q24h" = "38 (median)")))
res7 <- run_regimen(9.50, BWmin, 24, 0, "24 (min)")
res8 <- run_regimen(9.50, BWmax, 24, 0, "75 (max)")
sim_BW <- bind_rows(res6$sim, res7$sim, res8$sim)
auc_BW <- bind_rows(res6$auc, res7$auc, res8$auc)
auc_summary <- auc_BW %>%
group_by(regimen) %>%
summarize(median_AUC_0_24 = median(AUC_0_24),
mean_AUC_0_24   = mean(AUC_0_24),
sd_AUC_0_24     = sd(AUC_0_24),
PTA             = mean(AUC_0_24 >= 28) * 100,
.groups = "drop")
auc_summary %>%
kable(
format   = "latex", # PDF/LaTeX output
booktabs = TRUE,    # nicer horizontal rules
digits   = 4,       # numeric rounding
col.names = c("Body Weight (kg)", "Median", "Mean", "SD", "PTA (%)"),
align    = c("l", "r", "r", "r", "r"),
longtable = TRUE
)
install.packages("bookdown")
View(auc_BW)
#| include: false
if (!require("pacman")) {
install.packages("pacman")
library(pacman)}
pacman::p_load(mrgsolve, ggplot2, kableExtra, tidyverse, bookdown)
